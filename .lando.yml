name: commons-wordpress
recipe: lemp
services:
  appserver:
    type: php:custom
    xdebug: debug, develop
    overrides:
      build: .
      image: knowledge-commons/wordpress:7.4
    build_as_root:
      - rm -f site/.env && ln -s /app/config/local/wordpress/.env site/.env
      - rm -f site/web/phpinfo.php && ln -s /app/config/local/php/phpinfo.php site/web/phpinfo.php
    config:
      php: config/local/php/php.ini
    scanner:
      okCodes:
        - 500
  appserver_nginx:
    scanner:
      okCodes:
        - 500
  database:
    type: mariadb
    portforward: 3306
    creds:
      user: wordpress
      password: wordpress
      database: wordpress
    volume:
      - database:/var/lib/mysql
  simplesamlphp:
    type: php:custom
    via: nginx
    overrides:
      build: ./simplesamlphp
      image: knowledge-commons/simplesamlphp:1.19
config:
  config:
    vhosts: config/local/nginx/nginx.conf
tooling:
  wp:
    service: appserver
    description: Runs WP-CLI commands
    cmd: wp